<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>SENACAIU - Tela Inicial</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body class="index">
  <div class="container">
    <h1>SENACAIU</h1>
    <div style="margin-bottom: 24px;">
      <button onclick="mostrarLogin()">Login</button>
      <button onclick="mostrarCadastro()">Cadastro</button>
    </div>

    <div id="formLogin">
      <h2>Login</h2>
      <input type="email" id="loginEmail" placeholder="Email" required><br>
      <input type="password" id="loginSenha" placeholder="Senha" required><br>
      <button onclick="fazerLogin()">Entrar</button>
      <p id="msgLogin" style="color:red;"></p>
    </div>

    <div id="formCadastro">
      <h2>Cadastro</h2>
      <input type="text" id="cadNome" placeholder="Nome completo" required><br>
      <input type="text" id="cadTelefone" placeholder="Telefone" required><br>
      <input type="email" id="cadEmail" placeholder="Email" required><br>
      <input type="password" id="cadSenha" placeholder="Senha" required><br>
      <button onclick="fazerCadastro()">Cadastrar</button>
      <p id="msgCadastro" style="color:red;"></p>
    </div>
  </div>

<script>
  // Exibe o formulário de login por padrão
  window.onload = function() {
    mostrarLogin();
  };

  function mostrarLogin() {
    document.getElementById('formCadastro').style.display = 'none';
    document.getElementById('formLogin').style.display = 'block';
  }

  function mostrarCadastro() {
    document.getElementById('formLogin').style.display = 'none';
    document.getElementById('formCadastro').style.display = 'block';
  }

  async function fazerCadastro() {
    const nome = document.getElementById('cadNome').value.trim();
    const telefone = document.getElementById('cadTelefone').value.trim();
    const email = document.getElementById('cadEmail').value.trim();
    const senha = document.getElementById('cadSenha').value.trim();
    const msg = document.getElementById('msgCadastro');

    msg.textContent = '';

    if (!nome || !telefone || !email || !senha) {
      msg.textContent = 'Preencha todos os campos.';
      return;
    }

    try {
      const res = await fetch('http://localhost:3000/cadastrar', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({nome, telefone, email, senha})
      });
      const data = await res.json();

      if(res.ok) {
        alert('Cadastro realizado com sucesso! Faça login.');
        mostrarLogin();
      } else {
        msg.textContent = data.error || 'Erro ao cadastrar.';
      }
    } catch(e) {
      msg.textContent = 'Erro ao conectar com o servidor.';
    }
  }

  async function fazerLogin() {
    const email = document.getElementById('loginEmail').value.trim();
    const senha = document.getElementById('loginSenha').value.trim();
    const msg = document.getElementById('msgLogin');

    msg.textContent = '';

    if (!email || !senha) {
      msg.textContent = 'Preencha todos os campos.';
      return;
    }

    try {
      const res = await fetch('http://localhost:3000/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({email, senha})
      });
      const data = await res.json();

      if(res.ok) {
        localStorage.setItem('usuario', JSON.stringify(data.usuario));
        window.location.href = 'dashboard.html';
      } else {
        msg.textContent = data.error || 'Login inválido.';
      }
    } catch(e) {
      msg.textContent = 'Erro ao conectar com o servidor.';
    }
  }
</script>
</body>
</html>